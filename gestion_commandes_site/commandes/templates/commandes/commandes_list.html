{% extends "base.html" %}
{% block content %}
<h1>Commandes</h1>
<form method="get" class="form-inline mb-3">
  <input type="text" name="q" placeholder="id ou produit" value="{{ request.GET.q }}" class="form-control mr-2">
  <select name="statut" class="form-control mr-2">
  <option value="">Tous statuts</option>
  {% for key, val in statut_choices %}
    <option value="{{ key }}" {% if request.GET.statut == key %}selected{% endif %}>{{ val }}</option>
  {% endfor %}
</select>
  <button class="btn btn-secondary">Filtrer</button>
  <a class="btn btn-outline-primary ml-2" href="{% url 'commandes:commandes-export-csv' %}?{% if request.GET.statut %}statut={{ request.GET.statut }}{% endif %}">Exporter CSV</a>
</form>
<table class="table table-hover">
<thead><tr><th>#</th><th>Produit</th><th>Fournisseur</th><th>Quantité</th><th>Date</th><th>Statut</th><th>Actions</th></tr></thead>
<tbody>
{% for o in commandes %}
<tr>
  <td><a href="{% url 'commandes:commande-detail' o.pk %}">{{ o.id }}</a></td>
  <td>{{ o.produit.nom }}</td>
  <td>{{ o.produit.fournisseur.nom }}</td>
  <td>{{ o.quantite }}</td>
  <td>{{ o.date_commande|date:"Y-m-d H:i" }}</td>
  <td>{{ o.get_statut_display }}</td>
  <td><a href="{% url 'commandes:livraison-update' o.pk %}">Gérer livraison</a></td>
</tr>
{% empty %}
<tr><td colspan="7">Aucune commande</td></tr>
{% endfor %}
</tbody>
</table>
{% endblock %}